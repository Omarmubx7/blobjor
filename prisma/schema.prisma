generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AdminUser {
  id             String    @id @default(cuid())
  email          String    @unique
  passwordHash   String    @map("password_hash")
  name           String
  role           String    @default("admin")
  isActive       Boolean   @default(true) @map("is_active")
  lastLogin      DateTime? @map("last_login")
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")
  failedAttempts Int       @default(0) @map("failed_attempts")
  lockedUntil    DateTime? @map("locked_until")

  @@map("admin_users")
}

model AdminSession {
  id        String   @id @default(cuid())
  adminId   String   @map("admin_id")
  token     String   @unique
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")

  @@index([token])
  @@index([adminId])
  @@map("admin_sessions")
}

model Category {
  id            String    @id @default(cuid())
  name          String
  nameEn        String?   @map("name_en")
  slug          String    @unique
  description   String?
  descriptionEn String?   @map("description_en")
  image         String?
  sortOrder     Int       @default(0) @map("sort_order")
  isActive      Boolean   @default(true) @map("is_active")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  products      Product[]

  @@index([slug])
  @@index([isActive])
  @@map("categories")
}

model Product {
  id                String           @id @default(cuid())
  name              String
  nameAr            String?          @map("name_ar")
  slug              String           @unique
  description       String?
  descriptionAr     String?          @map("description_ar")
  price             Float
  compareAtPrice    Float?           @map("compare_at_price")
  categoryId        String?          @map("category_id")
  colors            String?
  sizes             String?
  printAreas        String?          @map("print_areas")
  isActive          Boolean          @default(true) @map("is_active")
  isFeatured        Boolean          @default(false) @map("is_featured")
  allowCustomDesign Boolean          @default(false) @map("allow_custom_design")
  sortOrder         Int              @default(0) @map("sort_order")
  seoTitle          String?          @map("seo_title")
  seoDescription    String?          @map("seo_description")
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")
  customDesigns     CustomDesign[]
  orderItems        OrderItem[]
  images            ProductImage[]
  variants          ProductVariant[]
  category          Category?        @relation(fields: [categoryId], references: [id])

  @@index([slug])
  @@index([categoryId])
  @@index([isActive])
  @@index([isFeatured])
  @@map("products")
}

model ProductVariant {
  id        String  @id @default(cuid())
  productId String  @map("product_id")
  color     String
  size      String
  stock     Int     @default(0)
  sku       String? @unique
  isActive  Boolean @default(true) @map("is_active")
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, color, size])
  @@index([productId])
  @@map("product_variants")
}

model ProductImage {
  id        String   @id @default(cuid())
  productId String   @map("product_id")
  url       String
  publicId  String?  @map("public_id")
  altText   String?  @map("alt_text")
  altTextAr String?  @map("alt_text_ar")
  width     Int?
  height    Int?
  isPrimary Boolean  @default(false) @map("is_primary")
  sortOrder Int      @default(0) @map("sort_order")
  createdAt DateTime @default(now()) @map("created_at")
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([isPrimary])
  @@map("product_images")
}

model Customer {
  id               String         @id @default(cuid())
  name             String
  email            String?        @unique
  phone            String         @unique
  passwordHash     String?        @map("password_hash")
  role             String         @default("customer")
  emailVerified    DateTime?      @map("email_verified")
  image            String?
  address          String?
  city             String         @default("عمّان")
  totalOrders      Int            @default(0) @map("total_orders")
  totalSpent       Float          @default(0) @map("total_spent")
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt        DateTime       @updatedAt @map("updated_at")
  resetToken       String?        @unique @map("reset_token")
  resetTokenExpiry DateTime?      @map("reset_token_expiry")
  customDesigns    CustomDesign[]
  orders           Order[]

  @@index([phone])
  @@index([email])
  @@map("customers")
}

model Order {
  id              String          @id
  customerId      String?         @map("customer_id")
  customerName    String          @map("customer_name")
  customerEmail   String?         @map("customer_email")
  customerPhone   String          @map("customer_phone")
  customerAddress String          @map("customer_address")
  customerCity    String          @default("عمّان") @map("customer_city")
  totalPrice      Float           @map("total_price")
  shippingCost    Float           @default(0) @map("shipping_cost")
  status          String          @default("pending")
  paymentMethod   String          @default("cod") @map("payment_method")
  paymentStatus   String          @default("pending") @map("payment_status")
  notes           String?
  adminNotes      String?         @map("admin_notes")
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")
  couponId        String?         @map("coupon_id")
  discount        Float           @default(0)
  items           OrderItem[]
  coupon          Coupon?         @relation(fields: [couponId], references: [id])
  customer        Customer?       @relation(fields: [customerId], references: [id])
  statusHistory   StatusHistory[]

  @@index([status])
  @@index([createdAt])
  @@map("orders")
}

model Coupon {
  id            String    @id @default(cuid())
  code          String    @unique
  discountType  String    @default("percentage")
  discountValue Float     @map("discount_value")
  minOrderValue Float?    @default(0) @map("min_order_value")
  maxDiscount   Float?    @map("max_discount")
  expiresAt     DateTime? @map("expires_at")
  usageLimit    Int?      @map("usage_limit")
  usedCount     Int       @default(0) @map("used_count")
  isActive      Boolean   @default(true) @map("is_active")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  orders        Order[]

  @@map("coupons")
}

model OrderItem {
  id             String        @id @default(cuid())
  orderId        String        @map("order_id")
  productId      String?       @map("product_id")
  customDesignId String?       @map("custom_design_id")
  productType    String        @map("product_type")
  productName    String        @map("product_name")
  designData     String?       @map("design_data")
  color          String?
  size           String?
  quantity       Int           @default(1)
  unitPrice      Float         @map("unit_price")
  subtotal       Float
  printFileUrl   String?       @map("print_file_url")
  customDesign   CustomDesign? @relation(fields: [customDesignId], references: [id])
  order          Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product        Product?      @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
  @@index([customDesignId])
  @@map("order_items")
}

model CustomDesign {
  id             String      @id @default(cuid())
  productId      String?     @map("product_id")
  sessionId      String?     @map("session_id")
  customerId     String?     @map("customer_id")
  designImageUrl String      @map("design_image_url")
  designPublicId String?     @map("design_public_id")
  mockupImageUrl String?     @map("mockup_image_url")
  mockupPublicId String?     @map("mockup_public_id")
  config         String
  notes          String?
  status         String      @default("draft")
  createdAt      DateTime    @default(now()) @map("created_at")
  updatedAt      DateTime    @updatedAt @map("updated_at")
  customer       Customer?   @relation(fields: [customerId], references: [id])
  product        Product?    @relation(fields: [productId], references: [id])
  orderItems     OrderItem[]

  @@index([productId])
  @@index([sessionId])
  @@index([customerId])
  @@index([status])
  @@map("custom_designs")
}

model StatusHistory {
  id        String   @id @default(cuid())
  orderId   String   @map("order_id")
  oldStatus String?  @map("old_status")
  newStatus String   @map("new_status")
  notes     String?
  changedBy String?  @map("changed_by")
  changedAt DateTime @default(now()) @map("changed_at")
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@map("status_history")
}

model HomepageSection {
  id         String   @id @default(cuid())
  sectionKey String   @unique @map("section_key")
  title      String?
  titleAr    String?  @map("title_ar")
  subtitle   String?
  subtitleAr String?  @map("subtitle_ar")
  content    String?
  contentAr  String?  @map("content_ar")
  imageUrl   String?  @map("image_url")
  ctaText    String?  @map("cta_text")
  ctaTextAr  String?  @map("cta_text_ar")
  ctaLink    String?  @map("cta_link")
  isActive   Boolean  @default(true) @map("is_active")
  sortOrder  Int      @default(0) @map("sort_order")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@index([sectionKey])
  @@map("homepage_sections")
}

model FAQ {
  id         String   @id @default(cuid())
  question   String
  questionAr String   @map("question_ar")
  answer     String
  answerAr   String   @map("answer_ar")
  category   String?
  sortOrder  Int      @default(0) @map("sort_order")
  isActive   Boolean  @default(true) @map("is_active")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@index([category])
  @@index([isActive])
  @@map("faqs")
}

model Setting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  type      String   @default("string")
  group     String   @default("general")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([key])
  @@index([group])
  @@map("settings")
}

model Media {
  id         String   @id @default(cuid())
  filename   String
  url        String
  publicId   String?  @map("public_id")
  mimeType   String?  @map("mime_type")
  size       Int?
  width      Int?
  height     Int?
  alt        String?
  altAr      String?  @map("alt_ar")
  folder     String?
  uploadedBy String?  @map("uploaded_by")
  createdAt  DateTime @default(now()) @map("created_at")

  @@index([folder])
  @@index([createdAt])
  @@map("media")
}
